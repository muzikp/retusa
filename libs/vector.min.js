"use strict";var $=require("./locale").call,{filters:filters,validators:validators}=require("./parsers"),schemas=require("./schemas");const Array=require("./array");var{VectorValueError:VectorValueError}=require("./errors");const registry=new WeakMap,enums={_scale:1,_ordinal:2,_nominal:3,_binary:4,_date:5};function setRegistryProperty(e,t,r){var i=getRegistryProperty(e);i[t]=r,registry.set(e,i)}function getRegistryProperty(e,t=null){return t?registry.get(e)[t]:registry.get(e)}class Vector extends Array{constructor(){super(),[...arguments].length>0&&this.push(...arguments),registry.set(this,{})}type(e){return e?this.constructor.name:enums[`_${this.constructor.name.replace("Vector","").toLocaleLowerCase()}`]}push(){for(let e of[...arguments].flat(1/0))this.parse?super.push(this.parse(e)):super.push(e)}name(e){return e?(setRegistryProperty(this,"name",e),this):registry.get(this).name}title(e){return e?(setRegistryProperty(this,"title",e),this):registry.get(this).title}serialize(){return{values:this,name:this.name(),title:this.title()}}clone(){var e=Object.assign(Object.create(Object.getPrototypeOf(this)),this);return registry.set(e,getRegistryProperty(this)),e}}Vector.prototype.type=function(e){return e?this.constructor.name:enums[`_${this.constructor.name.replace("Vector","").toLocaleLowerCase()}`]},Vector.prototype.flush=function(){return this.length=0,this};class ScaleVector extends Vector{constructor(){super(...arguments)}}ScaleVector.prototype.parse=function(e){if(0===e||"0"===e)return 0;if(e){if(isNaN(e))throw new VectorValueError($("UyOj",{value:e}),{vector:this,value:e});return Number(e)}return null};const VectorMethodsModels=[{name:"sum",fn:Array.prototype.sum,filter:filters.number,wiki:{title:"gvdg",desription:"iMbD"},type:[1,2],returns:schemas.number},{name:"count",fn:Array.prototype.count,wiki:{title:"tdrm",description:"ULJX"},type:[1,2,3],returns:schemas.uint},{name:"avg",fn:Array.prototype.sum,filter:filters.number,wiki:{title:"eFdj",description:"UYJN"},type:[1],returns:schemas.number}];class VectorMethod{constructor(e,t){if(this.parent=t,"string"==typeof e){if(!VectorMethodsModels[e])throw new Error("Model not found: "+e);this.model=Models.vector[e]}else{if("object"!=typeof e)throw new Error("Unknown VectorMethod constructor parameter type.");this.model=e}}get name(){return this.model.name}get fn(){return this.model.fn}get filter(){return this.model.filter?this.model.filter.fn:()=>!0}get wiki(){return this.model.wiki?{name:$(this.model.wiki.title),description:$(this.model.wiki.description),filter:this.model.filter?$(this.model.filter.text):null,applies:[{type:1,title:$("LOYN"),apply:this.model.type.indexOf(1)>-1},{type:2,title:$("zoiB"),apply:this.model.type.indexOf(2)>-1},{type:3,title:$("OkoC"),apply:this.model.type.indexOf(3)>-1}],example:this.model.example||null,arguments:function(e){var t=[];if(!e)return[];for(let r of Object.keys(e))t.push({name:r,title:e[r].wiki?.title?$(e[r].wiki.title):null,validator:e[r].validator?.text?$(e[r].validator?.text):null,description:e[r]?.wiki?.description?$(e[r].wiki.description):null,required:!!e[r]?.required,default:e[r].default||null,multiple:!!e[r].multiple});return t}(this.model.args)}:{}}call(){var e=this.validate(...arguments);return this.fn.call(this.parent,...e)}with(e){return this.parent=e,this}validate(){var e=0,t=Array.prototype.slice.call(arguments),r=[];if(0===(this.model.args||[]).length)return t;for(let s of Object.keys(this.model.args)){var i=this.model.args[s]?.validator?.fn||function(e){return e};if(t[e]||0===t[e]||!1===t[e])try{r.push(i(t[e]))}catch(e){throw new ArgumentError(s,this.model.args[s],this.model,e)}else{if(this.model.args[s]?.required)throw new Error($("dSWt",{name:this.model.args[s].name,title:this.model.args[s].wiki?.title}));r.push(this.model.args[s].default)}e++}return r}}VectorMethodsModels.forEach((function(e){Vector.prototype[e.name]=function(){var t=new VectorMethod(e,this);return t.call(...arguments)}})),module.exports={$:$,ScaleVector:ScaleVector};